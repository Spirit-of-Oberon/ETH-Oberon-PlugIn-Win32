(* OBERON System 3, Release 2.3.

Copyright 1999 ETH Zürich Institute for Computer Systems, 
ETH Center, CH-8092 Zürich.  e-mail: oberon@inf.ethz.ch.

This module may be used under the conditions of the general Oberon 
System 3 license contract.  The full text can be downloaded from

	"ftp://ftp.inf.ethz.ch/pub/software/Oberon/System3/license.txt;A"

Under the license terms stated it is in particular (a) prohibited to modify
the interface of this module in any way that disagrees with the style
or content of the system and (b) requested to provide all conversions
of the source code to another platform with the name OBERON. *)

MODULE Kernel32; (** non-portable / source: Win32.Kernel32.Mod *)	(* ejz  *)
	IMPORT S := SYSTEM;

	CONST
		NULL* = 0; False* = NULL; True* = False+1;
		InvalidHandleValue* = -1;
		FileAttributeReadOnly* = 01H; FileAttributeDirectory* = 010H; FileAttributeNormal* = 080H; FileAttributeTemporary* = 0100H;
		ErrorTooManyOpenFiles* = 4; ErrorAccessDenied* = 5; ErrorWriteProtect* = 19; ErrorSharingViolation* = 32; ErrorNetworkAccessDenied* = 65;
		GenericRead* = 080000000H; GenericWrite* = 040000000H;
		FileShareRead* = 1; FileShareWrite* = 2;
		FileFlagRandomAccess* = 010000000H;
		MoveFileReplaceExisting* = 1; MoveFileCopyAllowed* = 2;
		FileBegin* = 0;
		CreateAlways* = 2; OpenExisting* = 3;
		GMemMoveable* = 2; GMemShare* = 2000H;
		PageReadWrite* = 04H; PageExecuteReadWrite* = 040H; PageGuard* = 0100H;
		MEMCommit* = 01000H; MEMReserve* = 02000H; MEMDecommit* = 04000H; MEMRelease* = 08000H;
		ContextFull* = 65543; ContextControl* = 65537; ContextInteger* = 65538;
		ContextSegment* = 65540; ContextFloat* = 65544; ContextDebug* = 65552;
		DuplicateCloseSource* = 01H; DuplicateSameAccess* = 02H;
		ThreadBasePrioLowRT* = 15; ThreadBasePrioMax* = 2; ThreadBasePrioMin* = -2; ThreadBasePrioIdle* = -15;
		ThreadPrioLowest* = ThreadBasePrioMin;
		ThreadPrioBelowNormal* = ThreadPrioLowest+1;
		ThreadPrioNormal* = 0;
		ThreadPrioHighest* = ThreadBasePrioMax;
		ThreadPrioAboveNormal* = ThreadPrioHighest-1;
		ThreadPrioErrorReturn* = MIN(LONGINT);
		ThreadPrioTimeCritical* = ThreadBasePrioLowRT;
		ThreadPrioIdle* = ThreadBasePrioIdle;
		ExceptionContinueExecution* = -1; ExceptionContinueSearch* = 0; ExceptionExecuteHandler* = 1;
		CreateNewConsole* = 010H; StartFUseShowWindow* = 01H; StartFUseSTDHandles* = 0100H;
		STDInput* = -10; STDOutput* = -11; STDError* = -12;
		SizeOf80387Registers* = 80;
		ExceptionMaximumParameters* = 15;
		ExceptionGuardPage* = 080000001H;
		ExceptionBreakPoint* = 080000003H;
		ExceptionSingleStep* = 080000004H;
		ExceptionAccessViolation* = 0C0000005H;
		ExceptionIllegalInstruction* = 0C000001DH;
		ExceptionArrayBoundsExceeded* = 0C000008CH;
		ExceptionFltDenormalOperand* = 0C000008DH;
		ExceptionFltDivideByZero* = 0C000008EH;
		ExceptionFltInexactResult* = 0C000008FH;
		ExceptionFltInvalidOperation* = 0C0000090H;
		ExceptionFltOverflow* = 0C0000091H;
		ExceptionFltStackCheck* = 0C0000092H;
		ExceptionFltUndeflow* = 0C0000093H;
		ExceptionIntDivideByZero* = 0C0000094H;
		ExceptionIntOverflow* = 0C0000095H;
		ExceptionPrivInstruction* = 0C0000096H;
		ExceptionStackOverflow* = 0C00000FDH;

	TYPE
		ADDRESS* = LONGINT;
		FileTime* = RECORD
			lowDT*, highDT*: LONGINT
		END;
		FindData* = RECORD
			fileAttrs*: LONGINT;
			creation*, lastAcc*, lastWrite*: FileTime;
			sizeHigh*, sizeLow*: LONGINT;
			res0, res1: LONGINT;
			name*: ARRAY 260 OF CHAR;
			altName*: ARRAY 14 OF CHAR
		END;
		SmallRect* = RECORD
			left*, top*, right*, bottom*: SHORTINT
		END;
		SystemTime* = RECORD
			year*, month*, dayOfWeek*, day*: INTEGER;
			hour*, min*, sec*, millisec*: INTEGER
		END;
		CriticalSection* = RECORD
			a, b, c, d, e, f: LONGINT
		END;
		ThreadStartRoutine* = PROCEDURE (par: LONGINT): LONGINT;
		Object* = POINTER TO ObjectDesc;
		ObjectDesc* = RECORD
			handle*: LONGINT
		END;
		StartupInfo* = RECORD
			cb*, res*, desk*, title*: LONGINT;
			x*, y*, xSize*, ySize*: LONGINT;
			xCChars*, yCChars*: LONGINT;
			fillAttrs*, flags*: LONGINT;
			showWindow*, res2*: INTEGER;
			lres2*: LONGINT;
			in*, out*, err*: LONGINT
		END;
		ProcInfo* = RECORD
			hProc*, hThread*: LONGINT;
			procId*, threadId*: LONGINT
		END;
		SecurityAttrs* = RECORD 
			length*: LONGINT;
			lpSecurityDesc*: LONGINT;
    		inherit*: LONGINT
		END; 

		FloatingSaveArea* = RECORD [notag]
			ControlWord*, StatusWord*, TagWord*, ErrorOffset*, ErrorSelector*, DataOffset*, DataSelector*: LONGINT;
			RegisterArea*: ARRAY SizeOf80387Registers OF S.BYTE;
			Cr0NpxState*: LONGINT
		END;

		Context* = RECORD [notag]
			ContextFlags*: LONGINT;
			Dr0*, Dr1*, Dr2*, Dr3*, Dr6*, Dr7*: LONGINT;
			FloatSave*: FloatingSaveArea;
			SegGs*, SegFs*, SegEs*, SegDs*: LONGINT;
			Edi*, Esi*, Ebx*, Edx*, Ecx*, Eax*: LONGINT;
			Ebp*, Eip*, SegCs*, EFlags*, Esp*, SegSs*: LONGINT
		END;

		ExceptionRecordPtr* = LONGINT;
		ExceptionRecord* = RECORD [notag] 
			ExceptionCode*, ExceptionFlags*: LONGINT;
			nextExceptionRecord*: ExceptionRecordPtr;
			ExceptionAddress*: ADDRESS;
			NumberParameters*: LONGINT;
			ExceptionInformation*: LONGINT
		END; 

		ExcpFrmPtr*= LONGINT;
		ExcpFrmHandler* = PROCEDURE [stdcall] (VAR excpRec: ExceptionRecord; excpFrame: ExcpFrmPtr; VAR context: Context; dispatch: LONGINT): LONGINT;
		ExcpFrm* = RECORD [notag]
			link*: ExcpFrmPtr;
			handler*: ExcpFrmHandler
		END;

	VAR
		loadLibrary-: PROCEDURE (name: LONGINT): LONGINT;
		getProcAddress-: PROCEDURE (module, name: LONGINT): LONGINT;
		AllocConsole-: PROCEDURE (): LONGINT;
		CloseHandle-: PROCEDURE (handle: LONGINT): LONGINT;
		CompareFileTime-: PROCEDURE (FT1, FT2: LONGINT): LONGINT;
		CopyFile-: PROCEDURE (existing, new, failIfExist: LONGINT): LONGINT;
		CreateDirectory-: PROCEDURE (newDir, sa: LONGINT): LONGINT;
		CreateEvent-: PROCEDURE (securityAttr, manualReset, initialState, eventName: LONGINT): LONGINT;
		CreateFile-: PROCEDURE (name, accessMode, shareMode, securityAttr, createOpts, attrAndFlags, template: LONGINT): LONGINT;
		CreatePipe-: PROCEDURE (VAR read, write: LONGINT; securityAttr, size: LONGINT): LONGINT;
		CreateProcess-: PROCEDURE (appName, cmdLine, procAttr, threadAttr, inherit, flags, env, curDir, startInfo, procInfo: LONGINT): LONGINT;
		CreateThread-: PROCEDURE (sa, stackSize: LONGINT; thrProc: ThreadStartRoutine; thrAttr, flags: LONGINT; VAR id: LONGINT): LONGINT;
		DeleteCriticalSection-: PROCEDURE (CS: LONGINT);
		DeleteFile-: PROCEDURE (name: LONGINT): LONGINT;
		DeviceIoControl-: PROCEDURE (device, ioControlCode, inBuffer, inBufferSize, outBuffer, outBufferSize: LONGINT; VAR bytesReturned: LONGINT; overlapped: LONGINT): LONGINT;
		DuplicateHandle-: PROCEDURE (sourceProc, source, targetProc: LONGINT; VAR target: LONGINT; access, inherit, options: LONGINT): LONGINT;
		EnterCriticalSection-: PROCEDURE (CS: LONGINT);
		ExitProcess-: PROCEDURE (exitCode: LONGINT);
		ExitThread-: PROCEDURE (exitCode: LONGINT);
		FileTimeToLocalFileTime-: PROCEDURE (FT, LFT: LONGINT): LONGINT;
		FileTimeToSystemTime-: PROCEDURE (FT, ST: LONGINT): LONGINT;
		FindClose-: PROCEDURE (findFile: LONGINT): LONGINT;
		FindFirstFile-: PROCEDURE (searchFile, FD: LONGINT): LONGINT;
		FindNextFile-: PROCEDURE (findFile, FD: LONGINT): LONGINT;
		FlushFileBuffers-: PROCEDURE (file: LONGINT): LONGINT;
		FreeLibrary-: PROCEDURE (module: LONGINT): LONGINT;
		GetCommandLine-: PROCEDURE (): LONGINT;
		GetCurrentDirectory-: PROCEDURE (lenCurDir, curDir: LONGINT): LONGINT;
		GetCurrentProcess-: PROCEDURE (): LONGINT;
		GetCurrentThread-: PROCEDURE (): LONGINT;
		GetCurrentThreadId-: PROCEDURE (): LONGINT;
		GetDiskFreeSpace-: PROCEDURE (root: LONGINT; VAR SectorsPerCluster, BytesPerSector, FreeClusters, Clusters: LONGINT): LONGINT;
		GetDriveType-: PROCEDURE (driveName: LONGINT): LONGINT;
		GetExitCodeProcess-: PROCEDURE (handle: LONGINT; VAR code: LONGINT): LONGINT;
		GetFileAttributes-: PROCEDURE (fileName: LONGINT): LONGINT;
		GetFileSize-: PROCEDURE (file, highDIst: LONGINT): LONGINT;
		GetFileTime-: PROCEDURE (file, FTCreate, FTLastA, FTWrite: LONGINT): LONGINT;
		GetFullPathName-: PROCEDURE (file, path, lenPath: LONGINT; VAR pos: LONGINT): LONGINT;
		GetLastError-: PROCEDURE (): LONGINT;
		GetLocalTime-: PROCEDURE (systime: LONGINT);
		GetModuleFileName-: PROCEDURE (mod, name, len: LONGINT): LONGINT;
		GetModuleHandle-: PROCEDURE (name: LONGINT): LONGINT;
		GetPrivProfileString-: PROCEDURE (section, key, default, value, valLen, iniFile: LONGINT): LONGINT;
		GetStartupInfo-: PROCEDURE (startInfo: LONGINT);
		GetStdHandle-: PROCEDURE (device: LONGINT): LONGINT;
		GetSystemTime-: PROCEDURE (systime: LONGINT);
		GetTempFileName-: PROCEDURE (path, prefix, unique, tempName: LONGINT): LONGINT;
		GetTempPath-: PROCEDURE (lenTempDir, tempDir: LONGINT): LONGINT;
		GetThreadContext-: PROCEDURE (handle, context: LONGINT): LONGINT;
		GetThreadPriority-: PROCEDURE (handle: LONGINT): LONGINT;
		GetTickCount-: PROCEDURE (): LONGINT;
		GetVersion-: PROCEDURE(): LONGINT;
		GlobalAddAtom-: PROCEDURE (name: LONGINT): LONGINT;
		GlobalAlloc-: PROCEDURE (type, size: LONGINT): LONGINT;
		GlobalDeleteAtom-: PROCEDURE (atom: LONGINT): LONGINT;
		GlobalFree-: PROCEDURE (handle: LONGINT);
		GlobalGetAtomName-: PROCEDURE (atom, buf, bufLen: LONGINT): LONGINT;
		GlobalLock-: PROCEDURE (handle: LONGINT): LONGINT;
		GlobalUnlock-: PROCEDURE (handle: LONGINT);
		InitCriticalSection-: PROCEDURE (CS: LONGINT);
		InterlockedDecrement-: PROCEDURE (VAR addend: LONGINT): LONGINT;
		InterlockedIncrement-: PROCEDURE (VAR addend: LONGINT): LONGINT;
		LeaveCriticalSection-: PROCEDURE (CS: LONGINT);
		LocalFileTimeToFileTime-: PROCEDURE (LFT, FT: LONGINT): LONGINT;
		MoveFile-: PROCEDURE (existing, new: LONGINT): LONGINT;
		MoveFileEx-: PROCEDURE (existing, new, flags: LONGINT): LONGINT;
		MulDiv-: PROCEDURE (number, numerator, denominator: LONGINT): LONGINT;
		OutputDebugString-: PROCEDURE (adr: LONGINT);
		QueryPerformanceCounter-: PROCEDURE (counter: LONGINT): LONGINT;
		QueryPerformanceFrequency-: PROCEDURE (frequency: LONGINT): LONGINT;
		RaiseException-: PROCEDURE (dwExceptionCode, dwExceptionFlags, nNumberOfArguments, lpArguments: LONGINT); 
		ReadFile-: PROCEDURE (file, buf, lenBuf: LONGINT; VAR nRe: LONGINT; overlapp: LONGINT): LONGINT;
		ReadProcessMemory-: PROCEDURE (proc, adr, buf, len: LONGINT; VAR rLen: LONGINT): LONGINT;
		RemoveDirectory-: PROCEDURE (path: LONGINT): LONGINT;
		ResetEvent-: PROCEDURE (handle: LONGINT): LONGINT;
		ResumeThread-: PROCEDURE (handle: LONGINT): LONGINT;
		SearchPath-: PROCEDURE (path, file, ext, lenBuf, buf: LONGINT; VAR LPart: LONGINT): LONGINT;
		SetConsoleScreenBufferSize-: PROCEDURE (console, size: LONGINT): LONGINT;
		SetConsoleTitle-: PROCEDURE (title: LONGINT): LONGINT;
		SetConsoleWindowInfo-: PROCEDURE (console, absolut, rect: LONGINT): LONGINT;
		SetCurrentDirectory-: PROCEDURE (curDir: LONGINT): LONGINT;
		SetEvent-: PROCEDURE (handle: LONGINT): LONGINT;
		SetFilePointer-: PROCEDURE (file, dist, highDIst, method: LONGINT): LONGINT;
		SetFileTime-: PROCEDURE (file, FTCreate, FTLastA, FTWrite: LONGINT): LONGINT;
		SetHandleCount-: PROCEDURE (nofHandles: LONGINT): LONGINT;
		SetLocalTime-: PROCEDURE (systime: LONGINT);
		SetThreadContext-: PROCEDURE (handle, context: LONGINT): LONGINT;
		SetThreadPriority-: PROCEDURE (handle, prio: LONGINT): LONGINT;
		Sleep-: PROCEDURE (cMs: LONGINT);
		SuspendThread-: PROCEDURE (handle: LONGINT): LONGINT;
		SystemTimeToFileTime-: PROCEDURE (ST, FT: LONGINT): LONGINT;
		TerminateThread-: PROCEDURE (handle, exitCode: LONGINT): LONGINT;
		VirtualAlloc-: PROCEDURE (address, size, allocationType, protect: LONGINT): LONGINT;	
		VirtualFree-: PROCEDURE (address, size, freeType: LONGINT): LONGINT;
		VirtualProtect-: PROCEDURE (address, size, newProtect: LONGINT; VAR oldProtect: LONGINT): LONGINT;
		WaitForSingleObject-: PROCEDURE (handle, timeOut: LONGINT): LONGINT;
		WriteConsole-: PROCEDURE (hConsoleOutput, lpBuffer, nNumberOfCharsToWrite: LONGINT; VAR pNumberOfCharsWritten: LONGINT; lpReserved: LONGINT): LONGINT;
		WriteFile-: PROCEDURE (file, buf, lenBuf: LONGINT; VAR nWr: LONGINT; overlapp: LONGINT): LONGINT;
		WritePrivProfileString-: PROCEDURE (section, key, value, iniFile: LONGINT): LONGINT;
		WriteProcessMemory-: PROCEDURE (proc, adr, buf, len: LONGINT; VAR wLen: LONGINT): LONGINT;
		excpFrmHandler*: ExcpFrmHandler;
		threadAbortNotify*: ThreadStartRoutine;

	PROCEDURE MakeLong*(a, b: LONGINT): LONGINT;
		VAR l: LONGINT;
	BEGIN
		S.MOVE(S.ADR(a), S.ADR(l), 2);
		S.MOVE(S.ADR(b), S.ADR(l)+2, 2);
		RETURN l
	END MakeLong;

	PROCEDURE LoWord*(x: LONGINT): LONGINT;
	BEGIN
		RETURN x MOD 10000H
	END LoWord;
	
	PROCEDURE HiWord*(x: LONGINT): LONGINT;
	BEGIN
		x := S.LSH(x, -16); RETURN S.VAL(LONGINT, S.VAL(SET, x) * S.VAL(SET, 0FFFFH))
	END HiWord;

	PROCEDURE LongOr*(a, b: LONGINT): LONGINT;
	BEGIN
		RETURN S.VAL(LONGINT, S.VAL(SET, a) + S.VAL(SET, b))
	END LongOr;
	
	PROCEDURE Includes*(flags, option: LONGINT): BOOLEAN;
		VAR fl, op: SET;
	BEGIN
		fl := S.VAL(SET, flags); op := S.VAL(SET, option);
		RETURN (op * fl) = op
	END Includes;

	PROCEDURE LoadLibrary*(file: ARRAY OF CHAR): LONGINT;
	BEGIN
		RETURN loadLibrary(S.ADR(file))
	END LoadLibrary;

	PROCEDURE GetAdr*(lib: LONGINT; symbol: ARRAY OF CHAR; VAR adr: LONGINT);
	BEGIN
		ASSERT(lib # 0);
		adr := getProcAddress(lib, S.ADR(symbol))
	END GetAdr;

	(* get the currently installed execption frame *)
	PROCEDURE - GetCur 64H, 8BH, 0DH, 0, 0, 0, 0; (* MOV ECX, FS:[0] *)
	PROCEDURE GetCurrent(): ExcpFrmPtr;
		VAR cur: ExcpFrmPtr;
	BEGIN
		GetCur;
		S.GETREG(S.ECX, cur); (* RETURN ECX *)
		RETURN cur
	END GetCurrent;

	(* install a new exception frame *)
	PROCEDURE - SetCur 64H, 0A3H, 0, 0, 0, 0; (* MOV FS:[0], EAX *)
	PROCEDURE SetCurrent(cur: ExcpFrmPtr);
	BEGIN
		S.PUTREG(S.EAX, cur); (* EAX := cur *)
		SetCur
	END SetCurrent;

	PROCEDURE InstallExcpFrm*(VAR e: ExcpFrm);
	BEGIN
		e.link := GetCurrent();
		SetCurrent(S.VAL(ExcpFrmPtr, S.ADR(e)))
	END InstallExcpFrm;

	PROCEDURE [stdcall] *EmptyExcpFrmHandler(VAR excpRec: ExceptionRecord; excpFrame: ExcpFrmPtr; VAR context: Context; dispatch: LONGINT): LONGINT;
	BEGIN
		RETURN ExceptionContinueSearch
	END EmptyExcpFrmHandler;

	PROCEDURE InitAPI();
		VAR mod: LONGINT;
	BEGIN
		excpFrmHandler := EmptyExcpFrmHandler; threadAbortNotify := NIL;
		mod := LoadLibrary("Kernel32.DLL");
		GetAdr(mod, "AllocConsole", S.VAL(LONGINT, AllocConsole));
		GetAdr(mod, "CloseHandle", S.VAL(LONGINT, CloseHandle));
		GetAdr(mod, "CompareFileTime", S.VAL(LONGINT, CompareFileTime));
		GetAdr(mod, "CopyFileA", S.VAL(LONGINT, CopyFile));
		GetAdr(mod, "CreateDirectoryA", S.VAL(LONGINT, CreateDirectory));
		GetAdr(mod, "CreateEventA", S.VAL(LONGINT, CreateEvent));
		GetAdr(mod, "CreateFileA", S.VAL(LONGINT, CreateFile));
		GetAdr(mod, "CreatePipe", S.VAL(LONGINT, CreatePipe));
		GetAdr(mod, "CreateProcessA", S.VAL(LONGINT, CreateProcess));
		GetAdr(mod, "CreateThread", S.VAL(LONGINT, CreateThread));
		GetAdr(mod, "DeleteCriticalSection", S.VAL(LONGINT, DeleteCriticalSection));
		GetAdr(mod, "DeleteFileA", S.VAL(LONGINT, DeleteFile));
		GetAdr(mod, "DeviceIoControl", S.VAL(LONGINT, DeviceIoControl));
		GetAdr(mod, "DuplicateHandle", S.VAL(LONGINT, DuplicateHandle));
		GetAdr(mod, "EnterCriticalSection", S.VAL(LONGINT, EnterCriticalSection));
		GetAdr(mod, "ExitProcess", S.VAL(LONGINT, ExitProcess));
		GetAdr(mod, "ExitThread", S.VAL(LONGINT, ExitThread));
		GetAdr(mod, "FileTimeToLocalFileTime", S.VAL(LONGINT, FileTimeToLocalFileTime));
		GetAdr(mod, "FileTimeToSystemTime", S.VAL(LONGINT, FileTimeToSystemTime));
		GetAdr(mod, "FindClose", S.VAL(LONGINT, FindClose));
		GetAdr(mod, "FindFirstFileA", S.VAL(LONGINT, FindFirstFile));
		GetAdr(mod, "FindNextFileA", S.VAL(LONGINT, FindNextFile));
		GetAdr(mod, "FlushFileBuffers", S.VAL(LONGINT, FlushFileBuffers));
		GetAdr(mod, "FreeLibrary", S.VAL(LONGINT, FreeLibrary));
		GetAdr(mod, "GetCommandLineA", S.VAL(LONGINT, GetCommandLine));
		GetAdr(mod, "GetCurrentDirectoryA", S.VAL(LONGINT, GetCurrentDirectory));
		GetAdr(mod, "GetCurrentProcess", S.VAL(LONGINT, GetCurrentProcess));
		GetAdr(mod, "GetCurrentThread", S.VAL(LONGINT, GetCurrentThread));
		GetAdr(mod, "GetCurrentThreadId", S.VAL(LONGINT, GetCurrentThreadId));
		GetAdr(mod, "GetDiskFreeSpaceA", S.VAL(LONGINT, GetDiskFreeSpace));
		GetAdr(mod, "GetDriveTypeA", S.VAL(LONGINT, GetDriveType));
		GetAdr(mod, "GetExitCodeProcess", S.VAL(LONGINT, GetExitCodeProcess));
		GetAdr(mod, "GetFileAttributesA", S.VAL(LONGINT, GetFileAttributes));
		GetAdr(mod, "GetFileSize", S.VAL(LONGINT, GetFileSize));
		GetAdr(mod, "GetFileTime", S.VAL(LONGINT, GetFileTime));
		GetAdr(mod, "GetFullPathNameA", S.VAL(LONGINT, GetFullPathName));
		GetAdr(mod, "GetLastError", S.VAL(LONGINT, GetLastError));
		GetAdr(mod, "GetLocalTime", S.VAL(LONGINT, GetLocalTime));
		GetAdr(mod, "GetModuleFileNameA", S.VAL(LONGINT, GetModuleFileName));
		GetAdr(mod, "GetModuleHandleA", S.VAL(LONGINT, GetModuleHandle));
		GetAdr(mod, "GetPrivateProfileStringA", S.VAL(LONGINT, GetPrivProfileString));
		GetAdr(mod, "GetStartupInfoA", S.VAL(LONGINT, GetStartupInfo));
		GetAdr(mod, "GetStdHandle", S.VAL(LONGINT, GetStdHandle));
		GetAdr(mod, "GetSystemTime", S.VAL(LONGINT, GetSystemTime));
		GetAdr(mod, "GetTempFileNameA", S.VAL(LONGINT, GetTempFileName));
		GetAdr(mod, "GetTempPathA", S.VAL(LONGINT, GetTempPath));
		GetAdr(mod, "GetThreadContext", S.VAL(LONGINT, GetThreadContext));
		GetAdr(mod, "GetThreadPriority", S.VAL(LONGINT, GetThreadPriority));
		GetAdr(mod, "GetTickCount", S.VAL(LONGINT, GetTickCount));
		GetAdr(mod, "GetVersion", S.VAL(LONGINT, GetVersion));
		GetAdr(mod, "GlobalAddAtomA", S.VAL(LONGINT, GlobalAddAtom));
		GetAdr(mod, "GlobalAlloc", S.VAL(LONGINT, GlobalAlloc));
		GetAdr(mod, "GlobalDeleteAtom", S.VAL(LONGINT, GlobalDeleteAtom));
		GetAdr(mod, "GlobalFree", S.VAL(LONGINT, GlobalFree));
		GetAdr(mod, "GlobalGetAtomNameA", S.VAL(LONGINT, GlobalGetAtomName));
		GetAdr(mod, "GlobalLock", S.VAL(LONGINT, GlobalLock));
		GetAdr(mod, "GlobalUnlock", S.VAL(LONGINT, GlobalUnlock));
		GetAdr(mod, "InitializeCriticalSection", S.VAL(LONGINT, InitCriticalSection));
		GetAdr(mod, "InterlockedDecrement", S.VAL(LONGINT, InterlockedDecrement));
		GetAdr(mod, "InterlockedIncrement", S.VAL(LONGINT, InterlockedIncrement));
		GetAdr(mod, "LeaveCriticalSection", S.VAL(LONGINT, LeaveCriticalSection));
		GetAdr(mod, "LocalFileTimeToFileTime", S.VAL(LONGINT, LocalFileTimeToFileTime));
		GetAdr(mod, "MoveFileA", S.VAL(LONGINT, MoveFile));
		GetAdr(mod, "MoveFileExA", S.VAL(LONGINT, MoveFileEx));
		GetAdr(mod, "MulDiv", S.VAL(LONGINT, MulDiv));
		GetAdr(mod, "OutputDebugStringA", S.VAL(LONGINT, OutputDebugString));
		GetAdr(mod, "QueryPerformanceCounter", S.VAL(LONGINT, QueryPerformanceCounter));
		GetAdr(mod, "QueryPerformanceFrequency", S.VAL(LONGINT, QueryPerformanceFrequency));
		GetAdr(mod, "RaiseException", S.VAL(LONGINT, RaiseException));
		GetAdr(mod, "ReadFile", S.VAL(LONGINT, ReadFile));
		GetAdr(mod, "ReadProcessMemory", S.VAL(LONGINT, ReadProcessMemory));
		GetAdr(mod, "RemoveDirectoryA", S.VAL(LONGINT, RemoveDirectory));
		GetAdr(mod, "ResetEvent", S.VAL(LONGINT, ResetEvent));
		GetAdr(mod, "ResumeThread", S.VAL(LONGINT, ResumeThread));
		GetAdr(mod, "SearchPathA", S.VAL(LONGINT, SearchPath));
		GetAdr(mod, "SetConsoleScreenBufferSize", S.VAL(LONGINT, SetConsoleScreenBufferSize));
		GetAdr(mod, "SetConsoleTitleA", S.VAL(LONGINT, SetConsoleTitle));
		GetAdr(mod, "SetConsoleWindowInfo", S.VAL(LONGINT, SetConsoleWindowInfo));
		GetAdr(mod, "SetCurrentDirectoryA", S.VAL(LONGINT, SetCurrentDirectory));
		GetAdr(mod, "SetEvent", S.VAL(LONGINT, SetEvent));
		GetAdr(mod, "SetFilePointer", S.VAL(LONGINT, SetFilePointer));
		GetAdr(mod, "SetFileTime", S.VAL(LONGINT, SetFileTime));
		GetAdr(mod, "SetHandleCount", S.VAL(LONGINT, SetHandleCount));
		GetAdr(mod, "SetLocalTime", S.VAL(LONGINT, SetLocalTime));
		GetAdr(mod, "SetThreadContext", S.VAL(LONGINT, SetThreadContext));
		GetAdr(mod, "SetThreadPriority", S.VAL(LONGINT, SetThreadPriority));
		GetAdr(mod, "Sleep", S.VAL(LONGINT, Sleep));
		GetAdr(mod, "SuspendThread", S.VAL(LONGINT, SuspendThread));
		GetAdr(mod, "SystemTimeToFileTime", S.VAL(LONGINT, SystemTimeToFileTime));
		GetAdr(mod, "TerminateThread", S.VAL(LONGINT, TerminateThread));
		GetAdr(mod, "VirtualAlloc", S.VAL(LONGINT, VirtualAlloc));
		GetAdr(mod, "VirtualFree", S.VAL(LONGINT, VirtualFree));
		GetAdr(mod, "VirtualProtect", S.VAL(LONGINT, VirtualProtect));
		GetAdr(mod, "WaitForSingleObject", S.VAL(LONGINT, WaitForSingleObject));
		GetAdr(mod, "WriteConsoleA", S.VAL(LONGINT, WriteConsole));
		GetAdr(mod, "WriteFile", S.VAL(LONGINT, WriteFile));
		GetAdr(mod, "WritePrivateProfileStringA", S.VAL(LONGINT, WritePrivProfileString));
		GetAdr(mod, "WriteProcessMemory", S.VAL(LONGINT, WriteProcessMemory))
	END InitAPI;

BEGIN
	InitAPI()
END Kernel32.